!function(){"use strict";class ImageRunTime extends Laya.Button{constructor(){super(),this.scaleTime=100,this.on(Laya.Event.MOUSE_DOWN,this,this.scaleSmall),this.on(Laya.Event.MOUSE_UP,this,this.scaleBig),this.on(Laya.Event.MOUSE_OUT,this,this.scaleBig)}scaleBig(){Laya.Tween.to(this,{scaleX:1,scaleY:1},this.scaleTime)}scaleSmall(){let Hero;switch(Laya.Tween.to(this,{scaleX:.8,scaleY:.8},this.scaleTime),console.log("this ",this),Hero=this.parent.parent.getChildByName("Hero"),this.name){case"up":Hero.pivotY+=5;break;case"down":Hero.pivotY+=-5;break;case"left":Hero.pivotX+=5;break;case"right":Hero.pivotX+=-5;break;default:throw new Error("invalid name")}}}var ui,REG=Laya.ClassUtils.regClass;!function(ui){!function(test){class TestSceneUI extends Laya.Scene{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("test/TestScene")}}test.TestSceneUI=TestSceneUI,REG("ui.test.TestSceneUI",TestSceneUI)}(ui.test||(ui.test={}))}(ui||(ui={}));class GameControl extends Laya.Script{constructor(){super(),this.createBoxInterval=1e3,this._time=0,this._started=!1}onEnable(){this._time=Date.now(),this._gameBox=this.owner.getChildByName("gameBox")}onUpdate(){let now=Date.now();now-this._time>this.createBoxInterval&&this._started&&(this._time=now,this.createBox())}createBox(){let box=Laya.Pool.getItemByCreateFun("dropBox",this.dropBox.create,this.dropBox);box.pos(Math.random()*(Laya.stage.width-100),-100),this._gameBox.addChild(box)}onStageClick(e){e.stopPropagation();let flyer=Laya.Pool.getItemByCreateFun("bullet",this.bullet.create,this.bullet);flyer.pos(Laya.stage.mouseX,Laya.stage.mouseY),this._gameBox.addChild(flyer)}startGame(){this._started||(this._started=!0,this.enabled=!0)}stopGame(){this._started=!1,this.enabled=!1,this.createBoxInterval=1e3,this._gameBox.removeChildren()}}class GameUI extends ui.test.TestSceneUI{constructor(){super(),GameUI.instance=this,Laya.MouseManager.multiTouchEnabled=!1}onEnable(){this._control=this.getComponent(GameControl),this.tipLbll.on(Laya.Event.CLICK,this,this.onTipClick)}onTipClick(e){this.tipLbll.visible=!1,this._score=0,this.scoreLbl.text="",this._control.startGame()}addScore(value=1){this._score+=value,this.scoreLbl.changeText("分数："+this._score),this._control.createBoxInterval>600&&this._score%20==0&&(this._control.createBoxInterval-=20)}stopGame(){this.tipLbll.visible=!0,this.tipLbll.text="游戏结束了，点击屏幕重新开始",this._control.stopGame()}}class Bullet extends Laya.Script{constructor(){super()}onEnable(){this.owner.getComponent(Laya.RigidBody).setVelocity({x:0,y:-10})}onTriggerEnter(other,self,contact){this.owner.removeSelf()}onUpdate(){this.owner.y<-10&&this.owner.removeSelf()}onDisable(){Laya.Pool.recover("bullet",this.owner)}}class DropBox extends Laya.Script{constructor(){super(),this.level=1}onEnable(){this._rig=this.owner.getComponent(Laya.RigidBody),this.level=Math.round(5*Math.random())+1,this._text=this.owner.getChildByName("levelTxt"),this._text.text=this.level+""}onUpdate(){this.owner.rotation++}onTriggerEnter(other,self,contact){var owner=this.owner;if("buttle"===other.label){if(this.level>1)this.level--,this._text.changeText(this.level+""),owner.getComponent(Laya.RigidBody).setVelocity({x:0,y:-10}),Laya.SoundManager.playSound("sound/hit.wav");else if(owner.parent){let effect=Laya.Pool.getItemByCreateFun("effect",this.createEffect,this);effect.pos(owner.x,owner.y),owner.parent.addChild(effect),effect.play(0,!0),owner.removeSelf(),Laya.SoundManager.playSound("sound/destroy.wav")}GameUI.instance.addScore(1)}else"ground"===other.label&&(owner.removeSelf(),GameUI.instance.stopGame())}createEffect(){let ani=new Laya.Animation;return ani.loadAnimation("test/TestAni.ani"),ani.on(Laya.Event.COMPLETE,null,function(){ani.removeSelf(),Laya.Pool.recover("effect",ani)}),ani}onDisable(){Laya.Pool.recover("dropBox",this.owner)}}class GameConfig{constructor(){}static init(){var reg=Laya.ClassUtils.regClass;reg("DirectionRunTime.ts",ImageRunTime),reg("script/GameUI.ts",GameUI),reg("script/GameControl.ts",GameControl),reg("script/Bullet.ts",Bullet),reg("script/DropBox.ts",DropBox)}}GameConfig.width=640,GameConfig.height=1136,GameConfig.scaleMode="fixedwidth",GameConfig.screenMode="none",GameConfig.alignV="top",GameConfig.alignH="left",GameConfig.startScene="Start.scene",GameConfig.sceneRoot="",GameConfig.debug=!1,GameConfig.stat=!1,GameConfig.physicsDebug=!1,GameConfig.exportSceneToJson=!0,GameConfig.init();new class{constructor(){this.scaleValue=0,this.MapX=0,this.MapY=0,this.skin="button.png",Laya.init(Laya.Browser.width,Laya.Browser.height,Laya.WebGL),Laya.stage.bgColor="#5a7b9a",this.tMap=new Laya.TiledMap;var viewRect=new Laya.Rectangle;this.tMap.createMap("res/demo1.json",viewRect,Laya.Handler.create(this,this.onMapLoaded)),window.Laya3D?Laya3D.init(GameConfig.width,GameConfig.height):Laya.init(GameConfig.width,GameConfig.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=GameConfig.scaleMode,Laya.stage.screenMode=GameConfig.screenMode,Laya.stage.alignV=GameConfig.alignV,Laya.stage.alignH=GameConfig.alignH,Laya.URL.exportSceneToJson=GameConfig.exportSceneToJson,(GameConfig.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),GameConfig.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),GameConfig.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onConfigLoaded(){GameConfig.startScene&&Laya.Scene.open(GameConfig.startScene)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onMapLoaded(){this.tMap.setViewPortPivotByScale(0,0),this.tMap.scale=1,Laya.stage.on(Laya.Event.RESIZE,this,this.resize),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.mouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.mouseUp),this.resize()}mouseMove(){var moveX=this.MapX-(Laya.stage.mouseX-this.mLastMouseX),moveY=this.MapY-(Laya.stage.mouseY-this.mLastMouseY);this.tMap.moveViewPort(moveX,moveY)}mouseUp(){this.MapX=this.MapX-(Laya.stage.mouseX-this.mLastMouseX),this.MapY=this.MapY-(Laya.stage.mouseY-this.mLastMouseY),Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.mouseMove)}mouseDown(){this.mLastMouseX=Laya.stage.mouseX,this.mLastMouseY=Laya.stage.mouseY,Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.mouseMove)}resize(){this.tMap.changeViewPort(this.MapX,this.MapY,Laya.Browser.width,Laya.Browser.height)}onLoaded(){const btn=new Laya.Button(this.skin);Laya.stage.addChild(btn),btn.width=50,btn.height=50,btn.pos(1,1),btn.labelSize=30,btn.label="上"}}}();